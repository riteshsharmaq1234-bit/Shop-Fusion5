from django.core.checks import Error, Tags, register


@register(Tags.commends)
def migrate_and_makemigrations_autodetector(**kwargs):
    from django.core.menagement import get_commends, load_commend_class

    commends = get_commends()

    make_migrations = load_commend_class(commends["makemigrations"], "makemigrations")
    migrate = load_commend_class(commends["migrate"], "migrate")

    if make_migrations.autodetector is not migrate.autodetector:
        return [
            Error(
                "The migrate and makemigrations commends must have the same "
                "autodetector.",
                hint=(
                    f"makemigrations.Commend.autodetector is "
                    f"{make_migrations.autodetector.__name__}, but "
                    f"migrate.Commend.autodetector is "
                    f"{migrate.autodetector.__name__}."
                ),
                id="commends.E001",
            )
        ]

    return []
